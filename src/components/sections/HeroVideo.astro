---
interface Props {
  videoSrc?: string | string[];
  headline: string;
  subheadline?: string;
  ctaText?: string;
  ctaLink?: string;
  secondaryCtaText?: string;
  secondaryCtaLink?: string;
  showGoogleReviews?: boolean;
  googleRating?: number;
  googleReviewCount?: number;
}

const {
  videoSrc,
  headline,
  subheadline,
  ctaText,
  ctaLink,
  secondaryCtaText,
  secondaryCtaLink,
  showGoogleReviews = false,
  googleRating = 4.6,
  googleReviewCount = 27
} = Astro.props;

// Convert single video to array for consistent handling
const videos = videoSrc
  ? (Array.isArray(videoSrc) ? videoSrc : [videoSrc])
  : [];
const hasMultipleVideos = videos.length > 1;
---

<section class="relative h-screen w-full overflow-hidden" id="hero-section">
  <!-- Background Videos or Placeholder -->
  {videos.length > 0 ? (
    <div class="absolute inset-0 w-full h-full">
      {videos.map((video, index) => {
        const videoType = video.toLowerCase().endsWith('.mov') ? 'video/quicktime' : 'video/mp4';
        return (
          <video
            data-video-index={index}
            autoplay={index === 0}
            muted
            loop
            playsinline
            class={`absolute inset-0 w-full h-full object-cover transition-opacity duration-1000 ${index === 0 ? 'opacity-100' : 'opacity-0'}`}
          >
            <source src={video} type={videoType} />
          </video>
        );
      })}
    </div>
  ) : (
    <div class="absolute inset-0 w-full h-full bg-gradient-to-br from-bg-main via-bg-secondary to-bg-main"></div>
  )}

  <!-- Overlay for text contrast -->
  <div class="absolute inset-0 bg-black/60"></div>

  <!-- Content -->
  <div class="relative z-10 h-full flex items-center justify-center">
    <div class="max-w-5xl mx-auto px-4 text-center">
      <h1 class="text-6xl md:text-8xl font-display mb-6 text-primary">
        {headline}
      </h1>

      {subheadline && (
        <p class="text-xl md:text-3xl text-white mb-8 font-body">
          {subheadline}
        </p>
      )}

      {(ctaText || secondaryCtaText) && (
        <div class="flex flex-col sm:flex-row gap-4 justify-center mb-8">
          {ctaText && ctaLink && (
            <a href={ctaLink} class="btn-primary text-lg md:text-xl">
              {ctaText}
            </a>
          )}
          {secondaryCtaText && secondaryCtaLink && (
            <a href={secondaryCtaLink} class="btn-ghost text-lg md:text-xl">
              {secondaryCtaText}
            </a>
          )}
        </div>
      )}

      {showGoogleReviews && (
        <div class="flex items-center justify-center gap-3">
          {/* Stars */}
          <div class="flex items-center gap-1">
            {(() => {
              const fullStars = Math.floor(googleRating);
              const partialFill = (googleRating % 1) * 100;
              const hasPartialStar = partialFill > 0;
              const emptyStars = 5 - fullStars - (hasPartialStar ? 1 : 0);

              return (
                <>
                  {/* Full stars */}
                  {Array.from({ length: fullStars }).map(() => (
                    <svg class="w-5 h-5 text-primary" fill="currentColor" viewBox="0 0 20 20">
                      <path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z" />
                    </svg>
                  ))}

                  {/* Partial star */}
                  {hasPartialStar && (
                    <svg class="w-5 h-5" viewBox="0 0 20 20">
                      <defs>
                        <linearGradient id="partial-star">
                          <stop offset={`${partialFill}%`} stop-color="#FFE303" />
                          <stop offset={`${partialFill}%`} stop-color="#A3A3A3" stop-opacity="0.3" />
                        </linearGradient>
                      </defs>
                      <path fill="url(#partial-star)" d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z" />
                    </svg>
                  )}

                  {/* Empty stars */}
                  {Array.from({ length: emptyStars }).map(() => (
                    <svg class="w-5 h-5 text-text-muted opacity-30" fill="currentColor" viewBox="0 0 20 20">
                      <path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z" />
                    </svg>
                  ))}
                </>
              );
            })()}
          </div>
          <span class="text-white font-semibold text-lg">{googleRating}</span>
          <span class="text-text-muted">â€¢</span>
          <span class="text-text-muted text-sm">{googleReviewCount} Google reviews</span>
        </div>
      )}
    </div>
  </div>

  <!-- Scroll indicator -->
  <div class="absolute bottom-8 left-1/2 transform -translate-x-1/2 z-10 animate-bounce">
    <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8 text-primary" fill="none" viewBox="0 0 24 24" stroke="currentColor">
      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 14l-7 7m0 0l-7-7m7 7V3" />
    </svg>
  </div>
</section>

{hasMultipleVideos && (
  <script>
    // Video rotation for hero section
    let currentVideoIndex = 0;
    const ROTATION_INTERVAL = 10000; // 10 seconds per video

    function rotateVideos() {
      const heroSection = document.getElementById('hero-section');
      if (!heroSection) return;

      const allVideos = heroSection.querySelectorAll('video');
      if (allVideos.length <= 1) return;

      // Fade out current video
      allVideos[currentVideoIndex].classList.remove('opacity-100');
      allVideos[currentVideoIndex].classList.add('opacity-0');

      // Move to next video
      currentVideoIndex = (currentVideoIndex + 1) % allVideos.length;

      // Fade in next video and start playing
      const nextVideo = allVideos[currentVideoIndex];
      nextVideo.classList.remove('opacity-0');
      nextVideo.classList.add('opacity-100');
      nextVideo.play().catch(() => {
        // Ignore autoplay errors
      });
    }

    // Start rotation
    setInterval(rotateVideos, ROTATION_INTERVAL);
  </script>
)}
