---
interface Props {
  accessKey: string;
  redirectUrl: string;
}

const { accessKey, redirectUrl } = Astro.props;
---

<form
  id="contact-form"
  action="https://api.web3forms.com/submit"
  method="POST"
  class="space-y-6"
>
  <!-- Hidden fields -->
  <input type="hidden" name="access_key" value={accessKey} />
  <input type="hidden" name="subject" value="Nieuw bericht via FitCity website" />
  <input type="hidden" name="from_name" value="FitCity Website" />

  <!-- Honeypot spam prevention -->
  <input type="checkbox" name="botcheck" class="hidden" style="display: none;">

  <!-- Name -->
  <div>
    <label for="name" class="block text-sm font-semibold mb-2">
      Naam <span class="text-primary">*</span>
    </label>
    <input
      type="text"
      name="name"
      id="name"
      required
      class="w-full bg-bg-main border-2 border-text-muted/30 px-4 py-3 rounded-none focus:border-primary focus:outline-none transition-colors"
    />
  </div>

  <!-- Email -->
  <div>
    <label for="email" class="block text-sm font-semibold mb-2">
      E-mail <span class="text-primary">*</span>
    </label>
    <input
      type="email"
      name="email"
      id="email"
      required
      class="w-full bg-bg-main border-2 border-text-muted/30 px-4 py-3 rounded-none focus:border-primary focus:outline-none transition-colors"
    />
  </div>

  <!-- Phone -->
  <div>
    <label for="phone" class="block text-sm font-semibold mb-2">
      Telefoon
    </label>
    <input
      type="tel"
      name="phone"
      id="phone"
      class="w-full bg-bg-main border-2 border-text-muted/30 px-4 py-3 rounded-none focus:border-primary focus:outline-none transition-colors"
    />
  </div>

  <!-- Subject -->
  <div>
    <label for="subject-type" class="block text-sm font-semibold mb-2">
      Onderwerp <span class="text-primary">*</span>
    </label>
    <select
      name="subject_type"
      id="subject-type"
      required
      class="w-full bg-bg-main border-2 border-text-muted/30 px-4 py-3 rounded-none focus:border-primary focus:outline-none transition-colors cursor-pointer"
    >
      <option value="">Selecteer een onderwerp...</option>
      <option value="Proefles aanvragen">Proefles aanvragen</option>
      <option value="Lidmaatschap informatie">Lidmaatschap informatie</option>
      <option value="Algemene vraag">Algemene vraag</option>
      <option value="Anders">Anders</option>
    </select>
  </div>

  <!-- Message -->
  <div>
    <label for="message" class="block text-sm font-semibold mb-2">
      Bericht <span class="text-primary">*</span>
    </label>
    <textarea
      name="message"
      id="message"
      rows="5"
      required
      class="w-full bg-bg-main border-2 border-text-muted/30 px-4 py-3 rounded-none focus:border-primary focus:outline-none resize-none transition-colors"
    ></textarea>
  </div>

  <!-- Status Message -->
  <div id="form-status" class="hidden p-4 text-sm font-medium"></div>

  <!-- Submit -->
  <button type="submit" id="submit-button" class="btn-primary w-full disabled:opacity-50 disabled:cursor-not-allowed">
    VERSTUUR BERICHT
  </button>
</form>

<script is:inline>
  const form = document.getElementById('contact-form');
  const statusDiv = document.getElementById('form-status');
  const submitButton = document.getElementById('submit-button');

  if (form) {
    form.addEventListener('submit', async (e) => {
      e.preventDefault();
      
      // Set loading state
      submitButton.disabled = true;
      submitButton.textContent = 'VERZENDEN...';
      statusDiv.classList.add('hidden');
      statusDiv.classList.remove('bg-green-500/10', 'text-green-500', 'bg-red-500/10', 'text-red-500');

      const formData = new FormData(form);
      const object = Object.fromEntries(formData);
      const json = JSON.stringify(object);

      try {
        const response = await fetch('https://api.web3forms.com/submit', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
            'Accept': 'application/json'
          },
          body: json
        });
        
        const result = await response.json();
        
        if (response.status === 200) {
          statusDiv.textContent = "Je bericht is verzonden! We nemen zo snel mogelijk contact op.";
          statusDiv.classList.remove('hidden');
          statusDiv.classList.add('bg-green-500/10', 'text-green-500');
          form.reset();
        } else {
          console.error(result);
          statusDiv.textContent = result.message || "Er is iets misgegaan. Probeer het later opnieuw.";
          statusDiv.classList.remove('hidden');
          statusDiv.classList.add('bg-red-500/10', 'text-red-500');
        }
      } catch (error) {
        console.error(error);
        statusDiv.textContent = "Er is een netwerkfout opgetreden. Controleer je verbinding.";
        statusDiv.classList.remove('hidden');
        statusDiv.classList.add('bg-red-500/10', 'text-red-500');
      } finally {
        submitButton.disabled = false;
        submitButton.textContent = 'VERSTUUR BERICHT';
      }
    });
  }
</script>
